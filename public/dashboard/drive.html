<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Dashboard</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="Dashboard">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <!-- Include socket -->
        <!-- <script src="http://10.217.94.247:3000/socket.io/socket.io.js"></script> -->
    </head>
    <body>
        <div id="chosen"></div>
        <canvas id="canvas" width="400" height="400" style="border: 2px solid #333;"></canvas>
    </body>
    <script src="api.js"></script>
    <script>

    var server = new DinoAPI("DRIVE_DEMO");
    var players = {};
    var playerCount = 0;




    x = 0;
    y = 0;
    speed = 5;
    angle = 0;
    mod = 0;

    canvas = document.getElementById("canvas");
    context = canvas.getContext("2d");
    car = new Image();
    car.src = "http://i.imgur.com/uwApbV7.png";





    server.startHost(function(sessionKey) {
        document.body.innerHTML += "KEY " + sessionKey + "</br>";
    });

    server.onPlayer = function(id) {
        players[id] = {
            direction: 0, //-1: left, 0: straight, 1: right
            drawn: false,
        };
        var moveInterval = setInterval(function () {
            draw();
        }, 30);

        ++playerCount;
    };

    // Set Direction
    server.onEvent("GyroY", function(response) {
        console.log("message");
        console.log(response);
        players[response.id].direction = response.state.state;
        document.getElementById('direction-'+i).value = response.state.state;
        angle += response.state.state;
    });


    function draw() {
        context = canvas.getContext("2d");
        context.clearRect(0, 0, 800, 800);

        context.fillStyle = "rgb(200, 100, 220)";
        context.fillRect(50, 50, 100, 100);

        x += (speed * mod) * Math.cos(Math.PI / 180 * angle);
        y += (speed * mod) * Math.sin(Math.PI / 180 * angle);

        context.save();
        context.translate(x, y);
        context.rotate(Math.PI / 180 * angle);
        context.drawImage(car, -(car.width / 2), -(car.height / 2));
        context.restore();
    }

    </script>
</html>
